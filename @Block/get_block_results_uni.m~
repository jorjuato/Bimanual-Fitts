% Retrieves results from a bimanual Fitts experiment with variation of 
% either the phase (in-phase/anti-phase) or the viscosity.
% All plotting functionare included in the file. It won't work
% with experiments done before the inclusion of Loads
% won't load with getMultiResults_fbFull because it lacks a Load parameter
% in TP table. 

function DS = get_block_results_uni(data,hand)
    WList = getWuni(data);
    rep = getReplicationNumber(data);
    if rep > 1
        DS = cell(length(WList),rep+1);
    else
        DS = cell(length(WList),1);
    end
    repArr = zeros(length(WList),1);
    for i=1:length(data)
        %Check for a valid trial
        if ~isempty(findstr(data(i).EVENTS.LABELS{end},'INVALID_TRIAL'))            
            continue
        elseif isempty(findstr(data(i).EVENTS.LABELS{end},'ENDOFTRIAL'))
            display(sprintf('Data file corrupted: %s', data(i).FILE_NAME));
            display(sprintf('There may be a missing trial for TP: %d', data(i).TRIAL.TP));
            continue
        else        
            tr = struct('info',[],'data',[],'kinematics',[]);
            %Get basic information about the trial
            tr.info = get_trial_info_uni(data(i));
            %Get kinematic data 
            tr.data = get_trial_data_uni(tr.info,data(i),hand);
            %Get angular properties
            tr.data = get_trial_angular_properties(tr.data);

            %Compute indexes for f1,f2 and rep
            idx1 = find(WList==tr.info.W*100);
            repArr(idx1) = repArr(idx1) + 1;
            ridx = repArr(idx1);
            DS{idx1,ridx} = tr;
        end
    end
    %if rep > 1
    %    DS = concatenate_block_results_uni(DS);
    %end
end




